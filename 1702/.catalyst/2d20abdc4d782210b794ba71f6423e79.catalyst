{"title":{"en":"G2. Passable Paths (hard version)","ru":"G2. Проходимые пути (сложная версия)"},"contestId":"1702","problemIndex":"G2","timeLimit":{"en":"3 seconds","ru":"3 секунды"},"memLimit":{"en":"256 megabytes","ru":"256 мегабайт"},"inputFormat":{"en":"standard input","ru":"стандартный ввод"},"outputFormat":{"en":"standard output","ru":"стандартный вывод"},"problemHtml":{"en":"<p><span class=\"tex-font-style-bf\">This is a hard version of the problem. The only difference between an easy and a hard version is in the number of queries.</span></p><p>Polycarp grew a tree from $$$n$$$ vertices. We remind you that a tree of $$$n$$$ vertices is an undirected connected graph of $$$n$$$ vertices and $$$n-1$$$ edges that does not contain cycles.</p><p>He calls a set of vertices <span class=\"tex-font-style-it\">passable</span> if there is such a path in the tree that passes through each vertex of this set without passing through any edge twice. The path can visit other vertices (not from this set).</p><p>In other words, a set of vertices is called <span class=\"tex-font-style-it\">passable</span> if there is a simple path that passes through all the vertices of this set (and possibly some other).</p><p>For example, for a tree below sets $$$\\{3, 2, 5\\}$$$, $$$\\{1, 5, 4\\}$$$, $$$\\{1, 4\\}$$$ are <span class=\"tex-font-style-it\">passable</span>, and $$$\\{1, 3, 5\\}$$$, $$$\\{1, 2, 3, 4, 5\\}$$$ are not.</p><center> <img class=\"tex-graphics\" src=\"https://espresso.codeforces.com/b1b4a0adab4bb71796bacdb63ae0f8286f0c5bf8.png\" style=\"max-width: 100.0%;max-height: 100.0%;\" width=\"189px\"> </center><p>Polycarp asks you to answer $$$q$$$ queries. Each query is a set of vertices. For each query, you need to determine whether the corresponding set of vertices is <span class=\"tex-font-style-bf\">passable</span>.</p>","ru":"<p><span class=\"tex-font-style-bf\">Это сложная версия задачи. Единственное различие простой и сложной версии в количестве запросов.</span></p><p>Поликарп вырастил дерево из $$$n$$$ вершин. Напоминаем, что деревом из $$$n$$$ вершин называется неориентированный связный граф из $$$n$$$ вершин и $$$n-1$$$ ребра, не содержащий циклов.</p><p>Он называет множество вершин <span class=\"tex-font-style-it\">проходимым</span>, если существует такой путь в дереве, который проходит через каждую вершину этого множества, не проходя по какому-либо ребру дважды. Путь может посещать другие вершины (не из этого множества).</p><p>Иными словами, множество вершин называется <span class=\"tex-font-style-it\">проходимым</span>, если существует простой путь, который проходит по всем вершинам этого множества (и, возможно, каким-то другим).</p><p>Например для дерева ниже множества $$$\\{3, 2, 5\\}$$$, $$$\\{1, 5, 4\\}$$$, $$$\\{1, 4\\}$$$ <span class=\"tex-font-style-it\">проходимы</span>, а $$$\\{1, 3, 5\\}$$$, $$$\\{1, 2, 3, 4, 5\\}$$$&nbsp;— нет.</p><center> <img class=\"tex-graphics\" src=\"https://espresso.codeforces.com/b1b4a0adab4bb71796bacdb63ae0f8286f0c5bf8.png\" style=\"max-width: 100.0%;max-height: 100.0%;\" width=\"189px\"> </center><p>Поликарп просит вас ответить на $$$q$$$ запросов. Каждый запрос является множеством вершин. Для каждого запроса вам необходимо определить <span class=\"tex-font-style-it\">проходимо</span> ли соответствующее множество вершин.</p>"},"inSpecsHtml":{"en":"<div class=\"section-title\">Input</div><p>The first line of input contains a single integer $$$n$$$ ($$$1 \\le n \\le 2 \\cdot 10^5$$$) — number of vertices.</p><p>Following $$$n - 1$$$ lines a description of the tree..</p><p>Each line contains two integers $$$u$$$ and $$$v$$$ ($$$1 \\le u, v \\le n$$$, $$$u \\ne v$$$) — indices of vertices connected by an edge.</p><p>Following line contains single integer $$$q$$$ ($$$1 \\le q \\le 10^5$$$)&nbsp;— number of queries.</p><p>The following $$$2 \\cdot q$$$ lines contain descriptions of sets.</p><p>The first line of the description contains an integer $$$k$$$ ($$$1 \\le k \\le n$$$) — the size of the set.</p><p>The second line of the description contains $$$k$$$ of distinct integers $$$p_1, p_2, \\dots, p_k$$$ ($$$1 \\le p_i \\le n$$$) — indices of the vertices of the set.</p><p>It is guaranteed that the sum of $$$k$$$ values for all queries does not exceed $$$2 \\cdot 10^5$$$.</p>","ru":"<div class=\"section-title\">Входные данные</div><p>Первая строка входных данных содержит единственное целое число $$$n$$$ ($$$1 \\le n \\le 2 \\cdot 10^5$$$) — количество вершин дерева.</p><p>Следующие $$$n - 1$$$ строк содержат описание дерева.</p><p>Каждая строка содержит два целых числа $$$u$$$ и $$$v$$$ ($$$1 \\le u, v \\le n$$$, $$$u \\ne v$$$) — индексы вершин, соединённых ребром.</p><p>Далее следует строка с единственным целым числом $$$q$$$ ($$$1 \\le q \\le 10^5$$$)&nbsp;— количество запросов.</p><p>Следующие $$$2 \\cdot q$$$ строк содержат описания множеств.</p><p>Первая строка описания содержит целое число $$$k$$$ ($$$1 \\le k \\le n$$$) — размер множества.</p><p>Вторая строка описания содержит $$$k$$$ различных целых чисел $$$p_1, p_2, \\dots, p_k$$$ ($$$1 \\le p_i \\le n$$$) — индексы вершин множества.</p><p>Гарантируется, что сумма значений $$$k$$$ по всем запросам не превосходит $$$2 \\cdot 10^5$$$.</p>"},"outSpecsHtml":{"en":"<div class=\"section-title\">Output</div><p>Output $$$q$$$ lines, each of which contains the answer to the corresponding query. As an answer, output \"<span class=\"tex-font-style-tt\">YES</span>\" if the set is <span class=\"tex-font-style-bf\">passable</span>, and \"<span class=\"tex-font-style-tt\">NO</span>\" otherwise.</p><p>You can output the answer in any case (for example, the strings \"<span class=\"tex-font-style-tt\">yEs</span>\", \"<span class=\"tex-font-style-tt\">yes</span>\", \"<span class=\"tex-font-style-tt\">Yes</span>\" and \"<span class=\"tex-font-style-tt\">YES</span>\" will be recognized as a positive answer).</p>","ru":"<div class=\"section-title\">Выходные данные</div><p>Выведите $$$q$$$ строк, каждая из которых содержит ответ на соответствующий запрос. В качестве ответа выведите «<span class=\"tex-font-style-tt\">YES</span>», если множество проходимо, и «<span class=\"tex-font-style-tt\">NO</span>» в противном случае.</p><p>Вы можете выводить ответ в любом регистре (например, строки «<span class=\"tex-font-style-tt\">yEs</span>», «<span class=\"tex-font-style-tt\">yes</span>», «<span class=\"tex-font-style-tt\">Yes</span>» и «<span class=\"tex-font-style-tt\">YES</span>» будут распознаны как положительный ответ).</p>"},"noteHtml":{"en":null,"ru":null},"sampleTestcases":[{"id":1659344855203,"input":"5\n1 2\n2 3\n2 4\n4 5\n5\n3\n3 2 5\n5\n1 2 3 4 5\n2\n1 4\n3\n1 3 5\n3\n1 5 4\n","output":"YES\nNO\nYES\nNO\nYES\n"},{"id":1659344855204,"input":"5\n1 2\n3 2\n2 4\n5 2\n4\n2\n3 1\n3\n3 4 5\n3\n2 3 5\n1\n1\n","output":"YES\nNO\nYES\nYES\n"}],"submitUrl":"https://codeforces.com/contest/1702/submit","language":"python"}